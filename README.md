# Домашнее задание для ШРИ 2019 "Инфраструктура"

Проект тестировался на NodeJS 10.

Согласно ТЗ, проект разделен на 2 независимые директории: `agent` и `server`.

Для каждой из них можно выполнить команды `npm install` и `npm start`.

Сервер предоставляет эндпоинты, необходимые для процессов-агентов и пользовательский интерфейс.

Агент предоставляет эндпоинты для сервера. После получения команды на сборку от сервера, агент клонирует папку, указанную в команде, устанавливает зависимости (`npm install`), выполняет переданную команду по сборке, запускает (`npm test`), передает результаты обратно на сервер и удаляет временную директорию.

## Работа с исключительными ситуациями:

1. Агент прекратил работать между сборками.

   Сервер регулярно проверяет то, что агенты, которые подключались к нему, находятся в поднятом состоянии и могут отвечать на запросы.  
   Делается это с помощью эндпоинта `/isAlive` у агента.  
   Периодичность обращений и таймаут, после которого сервер решает, что агент не отвечает, указываются в файле с настройками сервера `config.ts`.

   В этом случае агенту проставляется статус "Ошибка", и задания на него могут назначаться только после перезапуска процесса и повторной регистрации на стороне сервера.

1. Агент прекратил работать в процессе выполнения сборки

   Агенту проставляется статус "Ошибка" (см. п. 1). Сборке, которую собирал данный агент, также проставляется статус "Ошибка". В stderr сборки пишется пояснение о том, что агент прекратил работать в процессе сборки

1. Агенты не справляются с поступающими заявками

   Все заявки кладутся в общую очередь заявок и выполняются ожидающими агентами по мере завершения их текущего задания.

1. Агент не смог соединиться с сервером при старте

   Производится несколько попыток соединиться с заданным таймаутом. Если ни одна не удалась - процесс агента отключается с ошибкой.

1. Агент не смог соединиться с сервером при отправке результата

   Если не удалось соединиться с сервером за заданное время - процесс агента завершается.